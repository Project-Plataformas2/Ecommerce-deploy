name: Test GKE Auth Plugin Installation
          
on:
  workflow_dispatch:   
          
jobs:
  test-install:
    runs-on: ubuntu-latest
          
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
          
      - name: Install dependencies and gke-gcloud-auth-plugin
        run: |
          sudo apt-get update
          
          # 1. Instala el CLI de Google Cloud
          sudo apt-get install -y openssl kubectl curl google-cloud-cli
          
          # 2. Carga el entorno (PATH) del gcloud CLI para que el shell lo encuentre
          # Esto es crucial para solucionar 'gcloud: command not found'
          source /etc/profile.d/google-cloud-cli.sh
          
          # 3. Instala el plugin de GKE como un componente de gcloud
          gcloud components install gke-gcloud-auth-plugin
          
          echo "export USE_GKE_GCLOUD_AUTH_PLUGIN=True" >> $GITHUB_ENV
          
      - name: Verify installations
        run: |
          echo "Checking versions..."
          kubectl version --client
          gcloud version
          
          # Verifica la existencia del binario del plugin
          if command -v gke-gcloud-auth-plugin >/dev/null 2>&1; then
            echo "✅ gke-gcloud-auth-plugin is installed!"
          else
            echo "❌ gke-gcloud-auth-plugin is NOT installed!"
            exit 1
          fi
