# Configuraciones globales (compartidas por todos los servicios)
global:
  namespace: prod
  pullPolicy: Always
  springProfilesActive: "prod" # SPRING_PROFILES_ACTIVE=dev de Compose
  zipkinBaseUrl: "http://zipkin:9411" # SPRING_ZIPKIN_BASE-URL
  eurekaRegion: "default"
  eurekaAvailabilityZones: "myzone"
  eurekaServiceUrlMyzone: "http://service-discovery:8761/eureka" # EUREKA_CLIENT_SERVICEURL_MYZONE
  eurekaServiceUrlDefaultZone: "http://service-discovery:8761/eureka/" # EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
  configServerUrl: "http://cloud-config:9296/" # SPRING_CONFIG_IMPORT
  springConfigImport: "optional:configserver:http://cloud-config:9296/"
# Servicios Core (de tu primer Compose)
zipkin:
  enabled: true # Agregado para control en Helm
  image:
    repository: "openzipkin/zipkin" # Imagen fija de Compose
    tag: "latest"
  replicaCount: 1
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "200m"
  service:
    type: ClusterIP
    port: 9411 # Puerto de Compose
  env: [] # Zipkin no tiene env extra en Compose
  blue:
    repository: "openzipkin/zipkin"
    tag: "latest"
    replicaCount: 1
  green:
    repository: "openzipkin/zipkin"
    tag: "latest"
    replicaCount: 1
  podSecurityContext: 
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  securityContext: 
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: true
      runAsNonRoot: true
      runAsUser: 1000
      allowPrivilegeEscalation: false

service-discovery:
  enabled: true
  image:
    repository: "selimhorri/service-discovery-ecommerce-boot"
    tag: "0.1.0" # Tag inicial; sobrescrito por pipeline a TAG
  replicaCount: 1
  resources:
    requests:
      memory: "1024Mi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "500m"
  service:
    type: ClusterIP
    port: 8761
  hpa:
    minReplicas: 1
    maxReplicas: 2
    cpuUtilization: 60
  blue:
    repository: "juaca2004/service-discovery"
    tag: "v1.2.3"
    replicaCount: 1
  green:
    repository: "juaca2004/service-discovery"
    tag: "v1.2.3"
    replicaCount: 1
  podSecurityContext: 
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  securityContext: 
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: false
      runAsNonRoot: true
      runAsUser: 1000
      allowPrivilegeEscalation: false

cloud-config:
  enabled: true
  image:
    # repository: "juaca2004/cloud-config"
    repository: "selimhorri/cloud-config-ecommerce-boot"
    tag: "0.1.0"
  replicaCount: 1
  resources:
    requests:
      memory: "1024Mi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "500m"
  service:
    type: ClusterIP
    port: 9296
  hpa:
    minReplicas: 1
    maxReplicas: 2
    cpuUtilization: 60
  blue:
    repository: "juaca2004/cloud-config"
    tag: "v1.2.3"
    replicaCount: 1
  green:
    repository: "juaca2004/cloud-config"
    tag: "v1.2.3"
    replicaCount: 1
  podSecurityContext: 
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  securityContext: 
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: false
      runAsNonRoot: true
      runAsUser: 1000
      allowPrivilegeEscalation: false
# Servicios Dependientes
api-gateway:
  enabled: true
  image:
    repository: "juaca2004/api-gateway"
    tag: "v1.2.3"
  replicaCount: 2 # Más réplicas para testing en dev
  resources:
    requests:
      memory: "768Mi"
      cpu: "500m"
    limits:
      memory: "1.5Gi"
      cpu: "1000m"
  service:
    type: ClusterIP
    port: 8080
  hpa:
    minReplicas: 1
    maxReplicas: 2
    cpuUtilization: 60
  podSecurityContext: 
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  securityContext: 
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: false
      runAsNonRoot: true
      runAsUser: 1000
      allowPrivilegeEscalation: false

proxy-client:
  enabled: true
  image:
    repository: "juaca2004/proxy-client"
    tag: "v1.2.3"
  replicaCount: 1
  resources:
    requests:
      memory: "1Gi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "500m"
  service:
    type: ClusterIP
    port: 8900
  hpa:
    minReplicas: 1
    maxReplicas: 2
    cpuUtilization: 60
  podSecurityContext: 
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  securityContext: 
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: false
      runAsNonRoot: true
      runAsUser: 1000
      allowPrivilegeEscalation: false
# Repite para los demás servicios dependientes (order-service, payment-service, etc.)
order-service:
  enabled: true
  image:
    repository: "juaca2004/order-service"
    tag: "v1.2.3"
  replicaCount: 1
  resources:
    requests:
      memory: "1Gi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "500m"
  service:
    type: ClusterIP
    port: 8300
  hpa:
    minReplicas: 1
    maxReplicas: 2
    cpuUtilization: 60
  podSecurityContext: 
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  securityContext: 
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: false
      runAsNonRoot: true
      runAsUser: 1000
      allowPrivilegeEscalation: false
# Repite para los demás servicios dependientes (order-service, payment-service, etc.)
payment-service:
  enabled: true
  image:
    repository: "juaca2004/payment-service"
    tag: "v1.2.3"
  replicaCount: 1
  resources:
    requests:
      memory: "1Gi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "500m"
  service:
    type: ClusterIP
    port: 8400
  hpa:
    minReplicas: 1
    maxReplicas: 2
    cpuUtilization: 60
  podSecurityContext: 
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  securityContext: 
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: false
      runAsNonRoot: true
      runAsUser: 1000
      allowPrivilegeEscalation: false
# Repite para los demás servicios dependientes (order-service, payment-service, etc.)
product-service:
  enabled: true
  image:
    repository: "juaca2004/product-service"
    tag: "v1.2.3"
  replicaCount: 1
  resources:
    requests:
      memory: "1Gi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "500m"
  service:
    type: ClusterIP
    port: 8500
  hpa:
    minReplicas: 1
    maxReplicas: 2
    cpuUtilization: 60
  podSecurityContext: 
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  securityContext: 
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: false
      runAsNonRoot: true
      runAsUser: 1000
      allowPrivilegeEscalation: false
# Repite para los demás servicios dependientes (order-service, payment-service, etc.)
shipping-service:
  enabled: true
  image:
    repository: "juaca2004/shipping-service"
    tag: "v1.2.3"
  replicaCount: 1
  resources:
    requests:
      memory: "1Gi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "500m"
  service:
    type: ClusterIP
    port: 8600
  hpa:
    minReplicas: 1
    maxReplicas: 2
    cpuUtilization: 60
  podSecurityContext: 
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  securityContext: 
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: false
      runAsNonRoot: true
      runAsUser: 1000
      allowPrivilegeEscalation: false

user-service:
  enabled: true
  image:
    repository: "juaca2004/user-service"
    tag: "v1.2.3"
  replicaCount: 1
  resources:
    requests:
      memory: "1Gi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "500m"
  service:
    type: ClusterIP
    port: 8700
  persistence:
    enabled: true # Si usa DB, agrega PVC
    storageClass: "standard"
    size: "5Gi"
  hpa:
    minReplicas: 1
    maxReplicas: 2
    cpuUtilization: 60
  podSecurityContext: 
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  securityContext: 
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: false
      runAsNonRoot: true
      runAsUser: 1000
      allowPrivilegeEscalation: false

favourite-service:
  enabled: true
  image:
    repository: "juaca2004/favourite-service"
    tag: "v1.2.3"
  replicaCount: 1
  resources:
    requests:
      memory: "1Gi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "500m"
  service:
    type: ClusterIP
    port: 8800
  hpa:
    minReplicas: 1
    maxReplicas: 2
    cpuUtilization: 60
  podSecurityContext: 
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  securityContext: 
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: false
      runAsNonRoot: true
      runAsUser: 1000
      allowPrivilegeEscalation: false
# Configuración de Ingress (para api-gateway, expuesto externamente)
ingress:
  enabled: true
  enabledTls: true
  allowHttp: true
  className: "nginx-internal"
  hosts:
    - host: api-gateway.dev.example.com # Cambia a tu dominio real (e.g., localhost para Minikube)
      paths:
        - path: /
          pathType: Prefix
  tls: # Opcional en dev; habilita para HTTPS
    - secretName: api-gateway-tls
      hosts:
        - api-gateway.dev.example.com
blueGreen:
  activeColor: blue # valores posibles: blue | green
# Monitoreo (opcional en dev)
prometheus:
  enabled: true
  serviceMonitor:
    enabled: true
# Autoscaling (ligero en dev)
hpa:
  enabled: true
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 70
#Canary
canary:
  enabled: true
  weight: 10
  image:
    tag: "0.1.0stage"
database:
  url: "jdbc:mysql://db:3306/ecommerce_db"
  username: "user"
  password: "12345"


db:
  podSecurityContext: 
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  securityContext: 
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: true
      runAsNonRoot: true
      runAsUser: 1000
      allowPrivilegeEscalation: false