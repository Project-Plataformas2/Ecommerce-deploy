1. primero es desplegar en la nube con un

terraform apply
gcloud container clusters get-credentials mygpccluster --region us-central1 --project plataformas2-356563

2. va a soltar una ip estatica, esa la copiamos, luego vamos al ECOMMERCE-DEPLOY y ahi entramos a la carpeta files/, eliminamos los certificados tls antiguos
y aplicamos estos comandos

export STATIC_IP="<LA IP ESTATICA>"
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout tls.key \
  -out tls.crt \
  -subj "/CN=${STATIC_IP}/O=SelfSignedProject"

3. Luego desde la carpeta ecommerce-app creamos el prometheus y grafana

# Crear namespace (ignorar si ya existe)
kubectl create ns monitoring || true

kubectl create ns monitoring
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update

helm upgrade --install monitoring prometheus-community/kube-prometheus-stack \
  -n monitoring \
  -f monitoring-values.yaml

# Esperar a que los pods de Loki est√©n listos
kubectl wait --for=condition=Ready pods --all -n monitoring --timeout=180s
kubectl get pods -n monitoring


4. Luego creamos loki

helm repo add grafana https://grafana.github.io/helm-charts
helm repo update

helm upgrade --install loki-stack grafana/loki-stack \
  -n monitoring \
  -f values-loki.yaml

helm upgrade --install tempo grafana/tempo \
  -n monitoring \
  --set traces.otlp.grpc.enabled=true \
  --set traces.otlp.http.enabled=true \
  --set tempoQuery.enabled=true


5. luego creamos el realase de myapp

helm install myapp ./ -f values-dev.yaml --namespace dev --create-namespace

kubectl delete pod -n monitoring -l app.kubernetes.io/name=grafana



